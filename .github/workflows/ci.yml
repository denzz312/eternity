name: CI

on:
  push:
    branches: [ "**" ]   # run on every branch
  workflow_dispatch:      # allow manual runs

jobs:
  build-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "21"
          cache: maven

      # Build + unit tests (Surefire) + JaCoCo report (HTML + XML)
      - name: Build and test
        run: mvn -B clean verify

      # Publish a JUnit test report as a Check on the commit
      - name: Publish JUnit report
        uses: mikepenz/action-junit-report@v4
        with:
          check_name: "JUnit Test Report"
          report_paths: "**/target/surefire-reports/*.xml"
          include_passed: true
          require_tests: true
          detailed_summary: true

#      # Upload raw test reports for evidence/screenshots
#      - name: Upload surefire & failsafe reports
#        if: always()
#        uses: actions/upload-artifact@v4
#        with:
#          name: surefire-reports
#          path: |
#            **/target/surefire-reports/*
#            **/target/failsafe-reports/*
#          if-no-files-found: warn
#
#      # Generate a Markdown coverage summary from JaCoCo XML
#      - name: Code coverage summary
#        uses: irongut/CodeCoverageSummary@v1.3.0
#        with:
#          filename: '**/target/site/jacoco/jacoco.xml'
#          badge: true
#          format: markdown
#          output: both
#
#      # Append the coverage table to the job summary (nice screenshot)
#      - name: Append coverage to job summary
#        run: |
#          echo "## Code Coverage" >> $GITHUB_STEP_SUMMARY
#          cat code-coverage-results.md >> $GITHUB_STEP_SUMMARY
#
#      # Upload JaCoCo HTML site (open index.html locally for the nice graphs)
#      - name: Upload JaCoCo HTML site
#        if: always()
#        uses: actions/upload-artifact@v4
#        with:
#          name: jacoco-site
#          path: '**/target/site/jacoco/*'
#          if-no-files-found: warn

